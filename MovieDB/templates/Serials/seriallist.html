{% load staticfiles %}
{% include "../base.html" %}

<link rel="stylesheet" href="{% static "Serials/styles/seriallist.css" %}" />
<title>Сериалы</title>


<body>
    <div class="headBlock"> 
        <span class="HeadName">Сериалы</span>
        <a href="{% url 'addmovie'%}" class="addserial">Добавить сериал</a>
    </div>
    <p class="pagedisc">
        Список сериалов отсортированный по году выхода и по названию последнего сезона. Если вы вдруг не нашли ваш сериал, просто добавьте его, нажав на кнопку "Добавить сериал".
    </p>
    <div class="serials">
        <div class="serialList" >
            {% for serial in SerialList %}
                <a href="{% url 'serial' serial.id %}" class="serial" title="{{serial.name}} / {{serial.originalname}} ({{serial.year}})">
                    <div class="poster">
                        <img height="200px" src={{serial.img.url}}>
                    </div>
                    <span >{{serial.name}} / {{serial.originalname}}</span>
                    <div class=serialsmallinfo>
                        <span>{{serial.year}}</span>
                        {% if serial.InMyList == "True" %}<span style="background-color: #546de5;color: white;padding: 2px;">В списке</span>{% endif %}</span>
                    </div>
                </a>
            {% endfor %}
        </div>
        <div class="filters">
            <span class="groupspan">Жанры</span>
            <div class="filter">
            {% for genre in Genrelist %}
                <label><input class="genre" type="checkbox" value="{{genre.tag}}"><span>{{genre.name}}</span></label>
            {% endfor %}
            </div>
            <button onclick="changeGenres()">Применить</button>
            <script>
                var genres=document.getElementsByClassName("genre");
                var urlParams = new URLSearchParams(window.location.search);
                var param = urlParams.get('genres');
                if (param!=null){
                    var param=param.split(" ");
                    for (var i=0;i<genres.length;i++){
                        if (param.includes(genres[i].value))
                            genres[i].checked=true
                    }
                } 
                delete urlParams
                delete param
                delete genres

                function changeGenres(){
                    var genres=document.getElementsByClassName("genre");
                    var url=new URL(window.location['href'])
                    var param="";
                    for (var i=0;i<genres.length;i++){
                        if (genres[i].checked)
                            param+=genres[i].value+" "
                    }
                    param=param.trimEnd();
                    url.searchParams.set('genres', param)
                    window.location.href=url['href']
                }
            </script>
        </div>
    </div>
</body>